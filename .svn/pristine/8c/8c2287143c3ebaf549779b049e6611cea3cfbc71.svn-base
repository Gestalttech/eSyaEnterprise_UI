$(function () {
    
});
$(document).ready(function () {
    $.contextMenu({
        selector: ".btn-actions",
        trigger: 'left',
        items: {
            edit: { name: localization.Edit, icon: "edit", callback: function (key, opt) { fnEditCounterMappingHeader(event, 'edit') } },
            //    view: { name: localization.View, icon: "view", callback: function (key, opt) { fnEditCounterMappingHeader(event, 'view') } },
            //    delete: { name: localization.Delete, icon: "delete", callback: function (key, opt) { fnEditCounterMappingHeader(event, 'delete') } }
            //}
        }
    });
    $(".context-menu-icon-edit").html("<span class='icon-contextMenu'><i class='fa fa-plus'></i> " + localization.AddOn + "</span>");
    //$(".context-menu-icon-view").html("<span class='icon-contextMenu'><i class='fa fa-eye'></i> " + localization.View + "</span>");
    //$(".context-menu-icon-delete").html("<span class='icon-contextMenu'><i class='fa fa-trash'></i> " + localization.Delete + "</span>");
});
function fnBusinessLocation_onChange() {
    fnGridLoadCounterMappingHeader();
}
function fnGridLoadCounterMappingHeader() {
    var d = [{ BusinessKey: 11, TokenType: 'DC', TokenPrefix: 'DC', TokenDesc: 'DC', CounterNumber: '1', CounterNumberDesc: '1', FloorId: '1', FloorName: '1', CounterKey: '1', ActiveStatus: true, edit: '' }];
    $("#jqgCounterMappingHeader").GridUnload();
    $("#jqgCounterMappingHeader").jqGrid({
        //url: getBaseURL() + '/CounterMapping/GetCounterMappingbyBusinessKey?businesskey=' + $("#cboBusinessLocation").val(),
        datatype: 'local',
        mtype: 'POST',
        data:d,
        contentType: 'application/json; charset=utf-8',
        ajaxGridOptions: { contentType: 'application/json; charset=utf-8' },
        colNames: [localization.BusinessKey, localization.TokenType, localization.TokenPrefix, localization.TokenDesc, localization.CounterNumber, localization.CounterNumberDesc, localization.FloorId, localization.FloorName,localization.CounterKey, localization.Active, localization.Actions],
        colModel: [
            { name: "BusinessKey", width: 50, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: true },
            { name: "TokenType", width: 50, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: true },
            { name: "TokenPrefix", width: 50, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: true },
            { name: "TokenDesc", editable: true, width: '100' },
            { name: "CounterNumber", width: 80, align: 'left', editable: true, editoptions: { maxlength: 6 }, resizable: false, hidden: false },
            { name: "CounterNumberDesc", width: 80, align: 'left', editable: true, editoptions: { maxlength: 6 }, resizable: false, hidden: false },
            { name: "FloorId", width: 50, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: true },
            { name: "FloorName", width: 80, align: 'left', editable: true, editoptions: { maxlength: 6 }, resizable: false, hidden: false },
            { name: "CounterKey", width: 50, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: true },
            { name: "ActiveStatus", width: 35, editable: true, align: 'center', edittype: "checkbox", formatter: 'checkbox', editoptions: { value: "true:false" } },
            {
                name: 'edit', search: false, align: 'left', width: 70, sortable: false, resizable: false,
                formatter: function (cellValue, options, rowdata, action) {
                    var i = options.rowId;
                    return '<button class="mr-1 btn btn-outline btn-actions" id="btnTokenActions' + i + '"><i class="fa fa-ellipsis-v"></i></button>'
                }
            },
        ],
        pager: "#jqpCounterMappingHeader",
        rowNum: 10,
        rowList: [10, 20, 50, 100],
        rownumWidth: '55',
        loadonce: true,
        viewrecords: true,
        gridview: true,
        rownumbers: true,
        height: 'auto',
        scroll: false,
        width: 'auto',
        autowidth: true,
        shrinkToFit: true,
        forceFit: true,
        caption: localization.CounterMappingHeader,
        loadComplete: function (data) {
            SetGridControlByAction();
            fnJqgridSmallScreen("jqgCounterMappingHeader");
        },
    }).jqGrid('navGrid', '#jqpCounterMappingHeader', { add: false, edit: false, search: false, del: false, refresh: false, refreshtext: 'Reload' }).jqGrid('navButtonAdd', '#jqpCounterMappingHeader', {
        caption: '<span class="fa fa-sync"></span> Refresh', buttonicon: "none", id: "custRefresh", position: "first", onClickButton: fnGridRefreshCounterMappingHeader
    });

  

}

function fnEditCounterMappingHeader(e, actiontype) {
    var rowid = $("#jqgCounterMappingHeader").jqGrid('getGridParam', 'selrow');
    var rowData = $('#jqgCounterMappingHeader').jqGrid('getRowData', rowid);
    $("#PopupCounterAddon").modal('show');
    fnGridLoadCounterAddon();
    $("#lblBusinessKey").text(rowData.BusinessKey);
    $("#lblTokenType").text(rowData.TokenType);
    $("#lblCounterNumber").text(rowData.CounterNumber);
    $("#lblFloor").text(rowData.FloorName);
}

function fnGridRefreshCounterMappingHeader() {
    $("#jqgCounterMappingHeader").setGridParam({ datatype: 'json', page: 1 }).trigger('reloadGrid');
}



function fnGridLoadCounterAddon() {
    $("#jqgCounterAddon").GridUnload();
    $("#jqgCounterAddon").jqGrid({
        //url: getBaseURL() + '/CounterMapping/GetCounterMappingbyBusinessKey?businesskey=' + $("#cboBusinessLocation").val(),
        datatype: 'json',
        mtype: 'POST',
        contentType: 'application/json; charset=utf-8',
        ajaxGridOptions: { contentType: 'application/json; charset=utf-8' },
        colNames: [localization.BusinessKey, localization.CounterKey, localization.AddOn, localization.FloorName, localization.ActiveStatus],
        colModel: [
            { name: "BusinessKey", width: 100, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: false },
            { name: "CounterKey", width: 100, align: 'left', editable: true, editoptions: { maxlength: 15 }, resizable: false, hidden: false },
            { name: "AddOn", editable: true, width: 150, edittype: "checkbox", formatter: 'checkbox', editoptions: { value: "true:false" }, formatoptions: { disabled: false } },
            { name: "FloorName", width: 120, align: 'left', editable: true, editoptions: { maxlength: 6 }, resizable: false, hidden: false },
            { name: "ActiveStatus", width: 135, editable: true, align: 'center',hidden:true, edittype: "checkbox", formatter: 'checkbox', editoptions: { value: "true:false" } },
             
        ],
        pager: "#jqpCounterAddon",
        rowNum: 10,
        rowList: [10, 20, 50, 100],
        rownumWidth: '55',
        loadonce: true,
        viewrecords: true,
        gridview: true,
        rownumbers: true,
        height: 'auto',
        scroll: false,
        width: 'auto',
        autowidth: true,
        shrinkToFit: true,
        forceFit: true,
        caption: localization.CounterAddon,
        loadComplete: function (data) {
            SetGridControlByAction();
            fnJqgridSmallScreen("jqgCounterAddon");
        },
    }).jqGrid('navGrid', '#jqpCounterAddon', { add: false, edit: false, search: false, del: false, refresh: false, refreshtext: 'Reload' }).jqGrid('navButtonAdd', '#jqpCounterMappingHeader', {
        caption: '<span class="fa fa-sync"></span> Refresh', buttonicon: "none", id: "custRefresh", position: "first", onClickButton: fnGridRefreshCounterMappingHeader
    });



}